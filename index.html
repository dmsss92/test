<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institution Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #f9fafb;
            --surface: #ffffff;
            --text-main: #1f2937;
            --text-dim: #6b7280;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --border: #e5e7eb;
            --ease: cubic-bezier(0.25, 1, 0.5, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); display: flex; flex-direction: column; min-height: 100vh; }

        /* --- Navigation --- */
        nav {
            position: sticky; top: 0; width: 100%; height: 64px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            z-index: 1000; border-bottom: 1px solid var(--border);
            padding: 0 5%; display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-weight: 600; font-size: 1rem; color: var(--text-main); display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo i { color: var(--accent); }

        .nav-links { display: flex; gap: 0.5rem; list-style: none; height: 100%; align-items: center; }
        .nav-item { position: relative; height: 100%; display: flex; align-items: center; }
        
        .nav-link, .drop-btn { 
            text-decoration: none; color: var(--text-dim); font-size: 0.85rem; font-weight: 500;
            padding: 8px 16px; border-radius: 6px; transition: 0.2s; cursor: pointer;
        }
        .nav-link:hover, .drop-btn:hover { background: #f3f4f6; color: var(--text-main); }
        .nav-link.active { color: var(--accent); background: #eff6ff; }

        /* Dropdown */
        .dropdown-menu {
            display: none; position: absolute; top: 60px; right: 0;
            background: var(--surface); min-width: 220px; border-radius: 8px;
            border: 1px solid var(--border); padding: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.2s var(--ease);
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-menu a {
            padding: 10px 12px; text-decoration: none; color: var(--text-dim);
            display: block; font-size: 0.85rem; border-radius: 6px; transition: 0.15s;
        }
        .dropdown-menu a:hover { background: #f9fafb; color: var(--accent); }
        .nav-item:hover .dropdown-menu { display: block; }

        /* --- Main Content --- */
        main { flex: 1; padding: 3rem 5%; width: 100%; max-width: 1200px; margin: 0 auto; }
        
        .hero-header { text-align: center; margin-bottom: 3rem; }
        .hero-header h1 { font-size: 1.8rem; font-weight: 600; color: var(--text-main); margin-bottom: 0.5rem; }
        .badge { font-size: 0.75rem; background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 99px; font-weight: 500; display: inline-block; margin-bottom: 1rem; }

        /* --- Professional Tables --- */
        .table-wrapper { 
            background: var(--surface); border: 1px solid var(--border); 
            border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
        }
        .table-scroll { overflow-x: auto; max-height: 70vh; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        
        /* Sticky Header Logic */
        th { 
            background: #f8fafc; color: var(--text-dim); font-size: 0.75rem; 
            font-weight: 600; text-transform: uppercase; padding: 1rem; letter-spacing: 0.05em;
            position: sticky; top: 0; z-index: 10; border-bottom: 1px solid var(--border);
        }
        td { padding: 1rem; font-size: 0.9rem; border-bottom: 1px solid var(--border); color: var(--text-main); }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #f9fafb; }

        /* --- Cards --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .card { 
            background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--accent); }
        .card-label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 4px; }
        .card-value { font-size: 0.95rem; font-weight: 500; margin-bottom: 12px; }

        /* --- Buttons & Links --- */
        .btn-link { 
            display: inline-flex; align-items: center; gap: 6px;
            color: var(--accent); font-size: 0.85rem; font-weight: 500; text-decoration: none;
            padding: 6px 12px; background: #eff6ff; border-radius: 6px; transition: 0.2s;
        }
        .btn-link:hover { background: var(--accent); color: white; }

        /* --- Footer --- */
        footer {
            background: white; border-top: 1px solid var(--border);
            padding: 2rem 5%; text-align: center; margin-top: auto;
        }
        .footer-text { color: var(--text-dim); font-size: 0.85rem; }
        .footer-links { margin-top: 10px; display: flex; justify-content: center; gap: 20px; font-size: 0.85rem; }
        .footer-links a { text-decoration: none; color: var(--text-dim); }
        .footer-links a:hover { color: var(--accent); }

        .loader { display: none; text-align: center; padding: 4rem; color: var(--text-dim); }
        .fa-spin { margin-right: 8px; }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="window.location.hash = 'home'">
            <i class="fa-solid fa-building-columns"></i> INSTITUTION PORTAL
        </div>
        <ul class="nav-links" id="main-nav"></ul>
    </nav>

    <main id="app">
        <div id="loader" class="loader"><i class="fa-solid fa-circle-notch fa-spin"></i> Loading Records...</div>
        <div id="content-area"></div>
    </main>

    <footer>
        <div class="footer-text">© 2024 Institution Portal. All Rights Reserved.</div>
        <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Help Center</a>
            <a href="#">Contact Admin</a>
        </div>
    </footer>

    <script>
        /**
         * ⚙️ CONFIGURATION
         */
        const SITE_CONFIG = {
            scriptURL: 'script.google.com/macros/s/AKfycbzeng1uc0VuWr4Uchz3PWF3rppUO60emCvFFdu-utobd62VMeSEpu1XYCCpUDP-11JX_Q/exec',
            pages: [
                { id: 'home', title: 'Home', type: 'static', content: `
                    <div class="hero-header">
                        <h1>Welcome to the Portal</h1>
                        <p style="color:var(--text-dim); max-width:600px; margin:0 auto;">
                            Secure access to institutional documents, society members, and administrative records. 
                            Select a category above to begin.
                        </p>
                        <br>
                        <div style="display:flex; gap:10px; justify-content:center;">
                           <div class="card" style="text-align:center; padding:20px; width:150px;">
                                <i class="fa-regular fa-folder-open" style="font-size:24px; color:var(--accent); margin-bottom:10px;"></i>
                                <div style="font-size:0.8rem; color:var(--text-dim)">Documents</div>
                           </div>
                           <div class="card" style="text-align:center; padding:20px; width:150px;">
                                <i class="fa-solid fa-users" style="font-size:24px; color:var(--accent); margin-bottom:10px;"></i>
                                <div style="font-size:0.8rem; color:var(--text-dim)">Members</div>
                           </div>
                        </div>
                    </div>` 
                },
                { 
                    title: 'Documents', 
                    type: 'dropdown', 
                    links: [
                        { id: 'society', title: 'Society Docs', type: 'dynamic', layout: 'card', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '85431680' },
                        { id: 'master', title: 'Master List', type: 'dynamic', layout: 'table', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '1430286757' },
                        { id: 'cbse', title: 'CBSE & Zone', type: 'dynamic', layout: 'card', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '885792851' }
                    ]
                },
                {
                    title: 'Directory',
                    type: 'dropdown',
                    links: [
                        { id: 'members', title: 'Society Members', type: 'dynamic', layout: 'table', sheetId: '1wrcR-9KSQl4WeiAzwBvNwDMqR4HNhOIZyZGjociO3iQ', gid: '0' }
                    ]
                }
            ]
        };

        const appArea = document.getElementById('content-area');
        const navBar = document.getElementById('main-nav');
        const loader = document.getElementById('loader');

        function init() {
            renderNav();
            window.addEventListener('hashchange', router);
            router();
        }

        function renderNav() {
            navBar.innerHTML = SITE_CONFIG.pages.map(item => {
                if (item.type === 'dropdown') {
                    return `
                        <li class="nav-item">
                            <span class="drop-btn">${item.title} <i class="fa-solid fa-chevron-down" style="font-size:10px; margin-left:4px;"></i></span>
                            <div class="dropdown-menu">
                                ${item.links.map(link => `<a href="#${link.id}">${link.title}</a>`).join('')}
                            </div>
                        </li>`;
                }
                return `<li class="nav-item"><a class="nav-link" href="#${item.id}" data-page="${item.id}">${item.title}</a></li>`;
            }).join('');
        }

        async function router() {
            const hash = window.location.hash.replace('#', '') || 'home';
            let page = null;
            SITE_CONFIG.pages.forEach(p => {
                if (p.id === hash) page = p;
                if (p.type === 'dropdown') {
                    const sub = p.links.find(l => l.id === hash);
                    if (sub) page = sub;
                }
            });

            appArea.innerHTML = '';
            document.querySelectorAll('.nav-link').forEach(a => a.classList.toggle('active', a.dataset.page === hash));
            
            if (!page) return;
            page.type === 'static' ? renderContent(page.content) : fetchAndRenderData(page);
        }

        async function fetchAndRenderData(page) {
            loader.style.display = 'block';
            try {
                const response = await fetch(`${SITE_CONFIG.scriptURL}?id=${page.sheetId}&gid=${page.gid}`);
                const data = await response.json();
                renderUI(page, data.rows, data.lastUpdated);
            } catch (err) {
                renderContent(`<div class="hero-header"><p style="color:red">Unable to load data.</p></div>`);
            } finally {
                loader.style.display = 'none';
            }
        }

        function renderUI(page, rows, updated) {
            const headers = Object.keys(rows[0]);
            let html = `
                <div class="hero-header">
                    <span class="badge"><i class="fa-regular fa-clock"></i> Updated: ${updated || 'Live'}</span>
                    <h1>${page.title}</h1>
                </div>`;

            if (page.layout === 'card') {
                html += `<div class="grid">`;
                rows.forEach(row => {
                    html += `<div class="card">`;
                    headers.forEach(h => { html += `<div class="card-label">${h}</div><div class="card-value">${formatCell(row[h])}</div>`; });
                    html += `</div>`;
                });
                html += `</div>`;
            } else {
                html += `<div class="table-wrapper"><div class="table-scroll"><table><thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead><tbody>
                    ${rows.map(row => `<tr>${headers.map(h => `<td>${formatCell(row[h])}</td>`).join('')}</tr>`).join('')}
                </tbody></table></div></div>`;
            }
            renderContent(html);
        }

        // ✨ SMART FORMATTING: Detects if link is PDF or Web
        function formatCell(val) {
            if (!val) return '<span style="color:#e5e7eb">—</span>';
            const str = String(val).trim();
            
            if (str.startsWith('http')) {
                // If it looks like a PDF
                if (str.toLowerCase().includes('pdf') || str.includes('drive.google.com')) {
                    return `<a href="${str}" target="_blank" class="btn-link"><i class="fa-regular fa-file-pdf"></i> View PDF</a>`;
                }
                return `<a href="${str}" target="_blank" class="btn-link"><i class="fa-solid fa-arrow-up-right-from-square"></i> Open Link</a>`;
            }
            return str;
        }

        function renderContent(html) {
            // Fade In Effect
            appArea.style.opacity = '0';
            appArea.innerHTML = html;
            setTimeout(() => {
                appArea.style.transition = 'opacity 0.4s ease';
                appArea.style.opacity = '1';
            }, 50);
        }

        init();
    </script>
</body>
</html>
