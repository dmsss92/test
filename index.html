<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #ffffff;
            --surface: #fcfcfd;
            --text-main: #111827;
            --text-dim: #6b7280;
            --accent: #2563eb;
            --border: #f3f4f6;
            /* Ultra-smooth timing */
            --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
            --transition-fast: 0.2s var(--ease);
            --transition-slow: 0.5s var(--ease);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); -webkit-font-smoothing: antialiased; }

        /* --- Minimal Navigation --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: saturate(180%) blur(20px);
            z-index: 1000; border-bottom: 1px solid var(--border);
            padding: 0 5%; display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-weight: 500; font-size: 0.9rem; letter-spacing: 0.05em; color: var(--text-main); cursor: pointer; }
        
        .nav-links { display: flex; gap: 0.5rem; list-style: none; height: 100%; }
        .nav-item { position: relative; display: flex; align-items: center; height: 100%; }
        
        .nav-link, .drop-btn { 
            text-decoration: none; color: var(--text-dim); font-size: 0.85rem; 
            padding: 6px 12px; border-radius: 4px; transition: var(--transition-fast);
        }
        .nav-link:hover, .drop-btn:hover { color: var(--text-main); background: var(--surface); }
        .nav-link.active { color: var(--accent); background: #eff6ff; }

        /* Subtle Dropdown Animation */
        .dropdown-menu {
            display: none; position: absolute; top: 55px; left: 0;
            background: white; min-width: 200px; border-radius: 8px;
            border: 1px solid var(--border); padding: 6px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            opacity: 0; transform: translateY(5px);
            animation: menuFade 0.25s var(--ease) forwards;
        }
        @keyframes menuFade {
            to { opacity: 1; transform: translateY(0); }
        }
        .dropdown-menu a {
            padding: 8px 12px; text-decoration: none; color: var(--text-dim);
            display: block; font-size: 0.8rem; border-radius: 4px; transition: 0.15s ease;
        }
        .dropdown-menu a:hover { background: var(--surface); color: var(--accent); }
        .nav-item:hover .dropdown-menu { display: block; }

        /* --- Minimal Content Area --- */
        main { margin-top: 60px; padding: 3rem 5%; }
        .container { max-width: 1000px; margin: 0 auto; opacity: 0; transform: translateY(8px); transition: var(--transition-slow); }
        .container.visible { opacity: 1; transform: translateY(0); }
        
        .hero { text-align: center; padding: 4rem 0; }
        .hero h1 { font-size: 1.75rem; font-weight: 500; letter-spacing: -0.02em; margin-bottom: 0.5rem; }
        .update-badge { font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.1em; border-bottom: 1px solid var(--border); padding-bottom: 4px; margin-bottom: 2rem; display: inline-block; }

        /* --- Clean Grid & Table --- */
        .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .card { 
            background: white; border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;
            transition: transform 0.3s var(--ease), box-shadow 0.3s var(--ease);
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.04); }
        .card-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
        .card-value { font-size: 0.85rem; font-weight: 400; margin-bottom: 12px; }

        .table-container { background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { font-weight: 500; font-size: 0.75rem; color: var(--text-dim); padding: 1rem; background: var(--surface); }
        td { padding: 1rem; font-size: 0.85rem; border-top: 1px solid var(--border); color: var(--text-main); }
        
        .doc-link { color: var(--accent); text-decoration: none; font-weight: 500; font-size: 0.8rem; }
        .doc-link:hover { text-decoration: underline; }

        .loader { display: none; text-align: center; padding: 5rem; font-size: 0.8rem; letter-spacing: 0.2em; color: var(--text-dim); }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="window.location.hash = 'home'">PORTAL</div>
        <ul class="nav-links" id="main-nav"></ul>
    </nav>

    <main id="app">
        <div id="loader" class="loader">LOADING...</div>
        <div id="content-area"></div>
    </main>

    <script>
        const SITE_CONFIG = {
            scriptURL: 'https://script.google.com/macros/s/AKfycbzeng1uc0VuWr4Uchz3PWF3rppUO60emCvFFdu-utobd62VMeSEpu1XYCCpUDP-11JX_Q/exec',
            pages: [
                { id: 'home', title: 'Home', type: 'static', content: '<div class="hero"><h1>Portal Access</h1><p style="color:var(--text-dim); font-size:0.9rem;">Select a category from the navigation to begin.</p></div>' },
                { 
                    title: 'Documents', 
                    type: 'dropdown', 
                    links: [
                        { id: 'society', title: 'Society', type: 'dynamic', layout: 'card', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '85431680' },
                        { id: 'master', title: 'Master', type: 'dynamic', layout: 'table', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '1430286757' },
                        { id: 'cbse', title: 'CBSE & Zone', type: 'dynamic', layout: 'card', sheetId: '1wgPQaYPCncNyyJnW-fu_nygIF-ZaoKBM5FQxALI8bF8', gid: '885792851' }
                    ]
                },
                {
                    title: 'Members',
                    type: 'dropdown',
                    links: [
                        { id: 'members-list', title: 'Society Members', type: 'dynamic', layout: 'table', sheetId: '1wrcR-9KSQl4WeiAzwBvNwDMqR4HNhOIZyZGjociO3iQ', gid: '0' }
                    ]
                }
            ]
        };

        let currentData = [];
        const appArea = document.getElementById('content-area');
        const navBar = document.getElementById('main-nav');
        const loader = document.getElementById('loader');

        function init() {
            renderNav();
            window.addEventListener('hashchange', router);
            router();
        }

        function renderNav() {
            navBar.innerHTML = SITE_CONFIG.pages.map(item => {
                if (item.type === 'dropdown') {
                    return `
                        <li class="nav-item">
                            <span class="drop-btn">${item.title}</span>
                            <div class="dropdown-menu">
                                ${item.links.map(link => `<a href="#${link.id}">${link.title}</a>`).join('')}
                            </div>
                        </li>`;
                }
                return `<li class="nav-item"><a class="nav-link" href="#${item.id}" data-page="${item.id}">${item.title}</a></li>`;
            }).join('');
        }

        async function router() {
            const hash = window.location.hash.replace('#', '') || 'home';
            let page = null;
            SITE_CONFIG.pages.forEach(p => {
                if (p.id === hash) page = p;
                if (p.type === 'dropdown') {
                    const sub = p.links.find(l => l.id === hash);
                    if (sub) page = sub;
                }
            });

            appArea.innerHTML = '';
            document.querySelectorAll('.nav-link').forEach(a => a.classList.toggle('active', a.dataset.page === hash));
            if (!page) return;
            page.type === 'static' ? renderContent(page.content) : fetchAndRenderData(page);
        }

        async function fetchAndRenderData(page) {
            loader.style.display = 'block';
            try {
                const response = await fetch(`${SITE_CONFIG.scriptURL}?id=${page.sheetId}&gid=${page.gid}`);
                const result = await response.json();
                currentData = result.rows;
                renderUI(page, result.lastUpdated);
            } catch (err) {
                renderContent(`<div class="hero"><p style="color:red; font-size:0.8rem;">Synchronization Error</p></div>`);
            } finally {
                loader.style.display = 'none';
            }
        }

        function renderUI(page, updated) {
            const headers = Object.keys(currentData[0]);
            let html = `<div class="hero">
                            <span class="update-badge">Last modified ${updated || 'recently'}</span>
                            <h1>${page.title}</h1>
                        </div>`;

            if (page.layout === 'card') {
                html += `<div class="data-grid">`;
                currentData.forEach(row => {
                    html += `<div class="card">`;
                    headers.forEach(h => { html += `<div class="card-label">${h}</div><div class="card-value">${formatCell(row[h])}</div>`; });
                    html += `</div>`;
                });
                html += `</div>`;
            } else {
                html += `<div class="table-container"><table><thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead><tbody>
                    ${currentData.map(row => `<tr>${headers.map(h => `<td>${formatCell(row[h])}</td>`).join('')}</tr>`).join('')}
                </tbody></table></div>`;
            }
            renderContent(html);
        }

        function formatCell(val) {
            if (!val) return 'â€”';
            const str = String(val).trim();
            return str.startsWith('http') ? `<a href="${str}" target="_blank" class="doc-link">View</a>` : str;
        }

        function renderContent(html) {
            appArea.innerHTML = `<div class="container" id="page-container">${html}</div>`;
            // Trigger the transition after a tiny delay
            requestAnimationFrame(() => {
                document.getElementById('page-container').classList.add('visible');
            });
        }

        init();
    </script>
</body>
</html>
